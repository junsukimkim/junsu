<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>공모 알림 (4인가족)</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#111111" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="header">
    <div class="title">
      <h1>공모 알림</h1>
      <p>가족 체크 + 캘린더(.ics) + 미리알림(단축어용 텍스트) + 자동 가져오기</p>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="events">일정</button>
      <button class="tab" data-tab="family">가족</button>
      <button class="tab" data-tab="export">내보내기</button>
    </nav>
  </header>

  <main class="main">
    <!-- EVENTS -->
    <section id="tab-events" class="panel active">
      <div class="card">
        <h2>자동 가져오기</h2>
        <p class="muted">
          범위: <b>오늘 ~ 다음달 말</b> (이번달 + 다음달을 합쳐서 보여줘요)
        </p>
        <div class="row">
          <button id="import-dart-range" class="btn primary" type="button">DART에서 일정 자동 채우기</button>
          <button id="reset-store" class="btn" type="button">가져온 일정 초기화(완전)</button>
        </div>
        <div id="import-status" class="muted" style="margin-top:10px;"></div>
        <small class="muted">
          ※ “완전 초기화”는 아이폰에서 캐시/서비스워커 때문에 0개가 계속 뜨는 문제를 막기 위해,
          저장/캐시를 싹 지우고 새로고침합니다.
        </small>
      </div>

      <div class="card">
        <div class="row space">
          <h2>공모주 일정</h2>
          <small class="muted">체크박스는 “준비/청약완료” 표시용이에요.</small>
        </div>
        <div id="events-list" class="list"></div>
      </div>

      <div class="card note">
        <h3>주의</h3>
        <p class="muted">
          일정은 참고용입니다. 최종 청약 일정/주간사/최소증거금은 반드시 공식 공시로 확인하세요.
        </p>
      </div>
    </section>

    <!-- FAMILY -->
    <section id="tab-family" class="panel">
      <div class="card">
        <h2>가족 관리</h2>
        <form id="family-form" class="form">
          <div class="row">
            <label>
              이름
              <input id="memberName" required placeholder="예: 엄마" />
            </label>
            <label>
              증권사 메모(선택)
              <input id="brokerNote" placeholder="예: 키움/미래에셋" />
            </label>
          </div>
          <button type="submit" class="btn primary">가족 추가</button>
        </form>
      </div>

      <div class="card">
        <h2>가족 목록</h2>
        <div id="family-list" class="list"></div>
        <small class="muted">기본으로 4명이 자동 생성돼요. 필요하면 이름만 바꿔도 OK.</small>
      </div>
    </section>

    <!-- EXPORT -->
    <section id="tab-export" class="panel">
      <div class="card">
        <h2>캘린더(.ics) 내보내기</h2>
        <p class="muted">
          아이폰에서는 .ics 파일을 열면 Apple Calendar로 “가져오기”가 됩니다.
          (알림은 캘린더 앱 알림 설정에 따릅니다)
        </p>

        <div class="form">
          <label>
            캘린더 이름(표시용)
            <input id="calName" value="공모 알림" />
          </label>

          <div class="row">
            <button id="export-all" class="btn primary">전체 일정 .ics 다운로드</button>
          </div>

          <details class="details">
            <summary>미리알림(아이폰 기본 Reminders)로 넣고 싶으면</summary>
            <ul class="muted">
              <li>웹에서 미리알림 앱에 “직접 자동 추가”는 제한이 있어요.</li>
              <li>대신 아래 버튼으로 <b>단축어용 텍스트</b>를 복사 → 단축어에서 “클립보드 텍스트로 미리알림 여러 개 만들기” 흐름으로 넣는 게 가장 안정적이에요.</li>
            </ul>
            <button id="copy-reminders-text" class="btn" type="button">미리알림(단축어용) 텍스트 복사</button>
            <div id="copy-status" class="muted" style="margin-top:8px;"></div>
          </details>
        </div>
      </div>
    </section>
  </main>

  <!-- MODAL -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-head">
        <h3 id="modal-title">상세</h3>
        <button id="modal-close" class="icon-btn" aria-label="닫기">✕</button>
      </div>
      <div id="modal-body"></div>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(()=>{});
    }
  </script>
</body>
</html>
